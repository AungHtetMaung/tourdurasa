<!DOCTYPE HTML>
<html>
   <head>
      <title>Sample of Simple HTML5 Template - Dezzain.com</title>
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
      <!-- jQuery library -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

      <!-- Latest compiled JavaScript -->
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
      <!-- For Map
          To be change the API key for its own google account
      -->
      <script type="text/javascript" src='http://maps.google.com/maps/api/js?key=AIzaSyB__dVwtbY_7Ftjii2XYlgjY93j42phkU8&libraries=places&region=JP'></script>
      <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
      <script src="js/locationpicker.jquery.js"></script>
      <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
        margin: 1%;
        padding: 1%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 2%;
        padding: 1%;
      }
      #somecomponent {
        height: 100%;
        margin: 1%;
        padding: 1%;
      }
      /* Optional: Makes the sample page fill the window. */

    </style>
  </head>
   <body>
     Location: <input type="text" id="somecomponent-address" style="width: 200px"/>
     <button id="route_add">Add</button>
     <div id="somecomponent"></div>
     Lat.: <input type="text" id="somecomponent-lat"/>
     Long.: <input type="text" id="somecomponent-lon"/>
     <button id="draw_route">Draw a route</button>
      <button id="drop" onclick="drop()">Drop Markers</button>
      <button id="load" onclick="getData()">ReadData</button>
      <div id="map"></div>
   <script>
      route_list = [];
      map = '';
      var markers = [];
      var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      var labelIndex = 0;
      //for cross-browsing
      var proxy = 'https://cors-anywhere.herokuapp.com/';

       $('#somecomponent').locationpicker({
            enableAutocomplete: true,
                enableReverseGeocode: true,
              radius: 0,
              inputBinding: {
                latitudeInput: $('#somecomponent-lat'),
                longitudeInput: $('#somecomponent-lon'),
                radiusInput: $('#somecomponent-radius'),
                locationNameInput: $('#somecomponent-address')
              },
              onchanged: function (currentLocation, radius, isMarkerDropped) {
                    var addressComponents = $(this).locationpicker('map').location.addressComponents;
                console.log(currentLocation);  //latlon
                updateControls(addressComponents); //Data
                }
            });
            // Store pointed route
            $('#route_add').click(function () {
               storeCoordinate($('#somecomponent-lat').val(), $('#somecomponent-lon').val() , route_list);
           });
           $('#draw_route').click(function () {
             map = new google.maps.Map(document.getElementById('map'), {
                     zoom: 16,
                     center: {lat: 37.167436, lng: 138.92280500000004},
                     mapTypeId: 'terrain'
                   });
              var flightPath = new google.maps.Polyline({
               path: route_list,
               geodesic: true,
               strokeColor: '#FF0000',
               strokeOpacity: 1.0,
               strokeWeight: 2
              });
              flightPath.setMap(map);
              drop(route_list);
          });
            function updateControls(addressComponents) {
              console.log(addressComponents);
            }

            function storeCoordinate(xVal, yVal, route_list) {
              var coverter = new google.maps.LatLng(xVal,yVal);
              route_list.push(coverter);
              for (var i = 0; i < route_list.length; i++) {
                //console.log(route_list[i].lat+':'+route_list[i].lng);
                console.log(route_list[i]);
              }
            }
            function drop(route_list) {
                clearMarkers();
                for (var i = 0; i < route_list.length; i++) {
                  addMarkerWithTimeout(route_list[i], i * 200,i);
                }
              }
          function addMarkerWithTimeout(position, timeout, label) {
                  window.setTimeout(function() {
                    markers.push(new google.maps.Marker({
                      position: position,
                      map: map,
                      animation: google.maps.Animation.DROP,
                      label: labels[labelIndex++ % labels.length]
                    }));
                  }, timeout);
                }
                function clearMarkers() {
                  for (var i = 0; i < markers.length; i++) {
                    markers[i].setMap(null);
                  }
                  markers = [];
                }
            function toggleBounce() {
              if (marker.getAnimation() !== null) {
                marker.setAnimation(null);
              } else {
                marker.setAnimation(google.maps.Animation.BOUNCE);
              }
            }
            function getData(){

            $.ajax({
              url: 'https://drive.google.com/open?id=1MXLAOSlglk_XMfbL2R4ADA241-HwEIib',
              headers: {'X-Requested-With': 'XMLHttpRequest'},
              dataType: "text/html",
              success: function (data) {
                console.log(data)
                alert(data);
              }
            });

          }
   </script>
   </body>
</html>
